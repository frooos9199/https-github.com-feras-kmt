# ูุธุงู ุงููุฑุงูุจุฉ ูุงูุชุญูููุงุช ๐

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุดุงูู ููุฑุงูุจุฉ ุฃุฏุงุก ุงููุธุงู ูุชุชุจุน ุงูุนูููุงุช ูู ุชุทุจูู KMT Marshal. ูููุฑ ุงููุธุงู ุฑุคูุฉ ูุงููุฉ ูุญุงูุฉ ุงููุธุงูุ ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุกุ ูุชุชุจุน ุงูุฃุฎุทุงุก.

## ุงูููููุงุช ุงูุฑุฆูุณูุฉ

### 1. ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### `OperationLog` - ุชุชุจุน ุงูุนูููุงุช
```sql
- id: ูุนุฑู ูุฑูุฏ ููุนูููุฉ
- operation: ููุน ุงูุนูููุฉ (event_create, user_register, notification_send, etc.)
- userId: ูุนุฑู ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุงูุนูููุฉ
- targetId: ูุนุฑู ุงููุฏู ููุนูููุฉ
- status: ุญุงูุฉ ุงูุนูููุฉ (success, error, pending)
- duration: ูุฏุฉ ุงูุนูููุฉ ุจุงููููู ุซุงููุฉ
- errorMessage: ุฑุณุงูุฉ ุงูุฎุทุฃ ุฅู ูุดูุช
- metadata: ุจูุงูุงุช ุฅุถุงููุฉ
- createdAt: ุชุงุฑูุฎ ุฅูุดุงุก ุงูุณุฌู
```

#### `ErrorLog` - ุชุชุจุน ุงูุฃุฎุทุงุก
```sql
- id: ูุนุฑู ูุฑูุฏ ููุฎุทุฃ
- type: ููุน ุงูุฎุทุฃ (api_error, db_error, email_error, etc.)
- operation: ุงูุนูููุฉ ุงูุชู ุณุจุจ ุงูุฎุทุฃ
- message: ุฑุณุงูุฉ ุงูุฎุทุฃ
- stack: Stack trace
- userId: ุงููุณุชุฎุฏู ุงููุชุฃุซุฑ
- url: ุงูุตูุญุฉ ุฃู API endpoint
- severity: ุฏุฑุฌุฉ ุงูุฎุทุฃ (low, medium, high, critical)
- resolved: ูู ุชู ุญู ุงููุดููุฉ
- resolvedAt: ุชุงุฑูุฎ ุงูุญู
- createdAt: ุชุงุฑูุฎ ุงูุฎุทุฃ
```

#### `SystemStats` - ุงูุฅุญุตุงุฆูุงุช ุงูููููุฉ
```sql
- id: ูุนุฑู ูุฑูุฏ
- date: ุงูุชุงุฑูุฎ
- totalUsers: ุฅุฌูุงูู ุงููุณุชุฎุฏููู
- activeUsers: ุงููุณุชุฎุฏููู ุงููุดุทูู
- totalEvents: ุฅุฌูุงูู ุงูุฃุญุฏุงุซ
- totalAttendances: ุฅุฌูุงูู ุทูุจุงุช ุงูุญุถูุฑ
- pendingRequests: ุงูุทูุจุงุช ุงููุนููุฉ
- totalOperations: ุฅุฌูุงูู ุงูุนูููุงุช
- successfulOperations: ุงูุนูููุงุช ุงููุงุฌุญุฉ
- failedOperations: ุงูุนูููุงุช ุงููุงุดูุฉ
- averageResponseTime: ูุชูุณุท ููุช ุงูุงุณุชุฌุงุจุฉ
- emailsSent: ุนุฏุฏ ุงูุฅููููุงุช ุงููุฑุณูุฉ
- notificationsSent: ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ
- serverUptime: ูุณุจุฉ ุชุดุบูู ุงูุฎุงุฏู
- createdAt: ุชุงุฑูุฎ ุงูุฅูุดุงุก
```

### 2. API Endpoints

#### `/api/monitoring/stats` - ุฅุญุตุงุฆูุงุช ุงููุธุงู
- **Method:** GET
- **Parameters:**
  - `period`: ุงููุชุฑุฉ ุงูุฒูููุฉ (24h, 7d, 30d)
- **Response:** ุฅุญุตุงุฆูุงุช ุดุงููุฉ ูููุธุงู

#### `/api/monitoring/operations` - ุงูุนูููุงุช ุงูุญุฏูุซุฉ
- **Method:** GET
- **Parameters:**
  - `limit`: ุนุฏุฏ ุงูุณุฌูุงุช ุงููุฑุงุฏ ุฅุฑุฌุงุนูุง
  - `status`: ููุชุฑุฉ ุญุณุจ ุงูุญุงูุฉ
  - `operation`: ููุชุฑุฉ ุญุณุจ ููุน ุงูุนูููุฉ
- **Response:** ูุงุฆูุฉ ุจุงูุนูููุงุช ูุน ุชูุงุตูููุง

#### `/api/cron/daily-stats` - ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุงูููููุฉ
- **Method:** GET
- **Headers:** `Authorization: Bearer {CRON_SECRET}`
- **Purpose:** ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูููู ูู ุฌุฏูู SystemStats

### 3. ููุชุจุฉ ุงููุฑุงูุจุฉ (`lib/monitoring.ts`)

#### ุฏูุงู ุงูุชุณุฌูู

##### `logOperation(operation, userId?, targetId?, metadata?)`
ุชุณุฌูู ุจุฏุงูุฉ ุนูููุฉ ูุฅุฑุฌุงุน ูุงุฆู ูุฅููุงููุง:
```typescript
const operation = await logOperation('notification_send', userId, targetId, { type: 'NEW_EVENT' });

// ... ุชูููุฐ ุงูุนูููุฉ ...

await operation.complete('success'); // ุฃู 'error' ูุน ุฑุณุงูุฉ ุงูุฎุทุฃ
```

##### `logError(type, message, operation?, userId?, url?, stack?, severity?, metadata?)`
ุชุณุฌูู ุฎุทุฃ ูู ุงููุธุงู:
```typescript
await logError('api_error', 'Database connection failed', 'user_register', userId, '/api/auth/register');
```

##### `updateLastLogin(userId)`
ุชุญุฏูุซ ููุช ุขุฎุฑ ุชุณุฌูู ุฏุฎูู ูููุณุชุฎุฏู.

##### `updateDailyStats()`
ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูููู ูู ุฌุฏูู SystemStats.

### 4. ููุญุฉ ุงููุฑุงูุจุฉ

#### ุงูุตูุญุฉ: `/admin/monitoring`
ุชููุฑ ูุงุฌูุฉ ุดุงููุฉ ููุฑุงูุจุฉ ุงููุธุงู ูุน:

- **ูุธุฑุฉ ุนุงูุฉ:** ุญุงูุฉ ุงููุธุงูุ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏููู ูุงูุฃุญุฏุงุซ
- **ุงูุนูููุงุช:** ูุงุฆูุฉ ุจุงูุนูููุงุช ุงูุญุฏูุซุฉ ูุน ุญุงูุงุชูุง
- **ุงูุฃุฎุทุงุก:** ุฅุฏุงุฑุฉ ูุชุชุจุน ุงูุฃุฎุทุงุก (ููุฏ ุงูุชุทููุฑ)

#### ุงูููุฒุงุช:
- ููุชุฑุฉ ุงูุจูุงูุงุช ุญุณุจ ุงููุชุฑุฉ ุงูุฒูููุฉ (24 ุณุงุนุฉุ 7 ุฃูุงูุ 30 ููู)
- ุนุฑุถ ูู ุงูููุช ุงููุนูู
- ุชุตููู ูุชุฌุงูุจ ูุน ูุงุฌูุฉ ุฏุงููุฉ

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชุชุจุน ุงูุนูููุงุช ูู ุงูููุฏ

```typescript
import { logOperation, logError } from '@/lib/monitoring';

export async function createEvent(data: EventData, userId: string) {
  const operation = await logOperation('event_create', userId, undefined, {
    title: data.titleEn,
    marshalTypes: data.marshalTypes
  });

  try {
    // ... ููุทู ุฅูุดุงุก ุงูุญุฏุซ ...

    await operation.complete('success');
    return { success: true, eventId };

  } catch (error) {
    await logError('db_error', error.message, 'event_create', userId);
    await operation.complete('error', error.message);
    throw error;
  }
}
```

### 2. ุฅุนุฏุงุฏ Cron Job ููุฅุญุตุงุฆูุงุช ุงูููููุฉ

```bash
# Cron job ูุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ููููุงู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
0 2 * * * curl -H "Authorization: Bearer YOUR_CRON_SECRET" https://your-domain.com/api/cron/daily-stats
```

### 3. ูุฑุงูุจุฉ ุงูุฃุฏุงุก

- ุงุณุชุฎุฏู ููุญุฉ ุงููุฑุงูุจุฉ `/admin/monitoring` ููุฑุงุฌุนุฉ ุงูุฃุฏุงุก
- ุฑุงูุจ ูุนุฏูุงุช ุงูุฃุฎุทุงุก ูุงูุนูููุงุช ุงููุงุดูุฉ
- ุชุงุจุน ูุชูุณุท ุฃููุงุช ุงูุงุณุชุฌุงุจุฉ
- ุชุญูู ูู ุญุงูุฉ ุงูุฎุฏูุงุช ุงููุฎุชููุฉ

## ุฃููุงุน ุงูุนูููุงุช ุงููุฏุนููุฉ

- `event_create` - ุฅูุดุงุก ุญุฏุซ ุฌุฏูุฏ
- `user_register` - ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
- `attendance_request` - ุทูุจ ุญุถูุฑ ุญุฏุซ
- `email_send` - ุฅุฑุณุงู ุฅูููู
- `notification_send` - ุฅุฑุณุงู ุฅุดุนุงุฑ
- `admin_approve` - ููุงููุฉ ุฅุฏูู ุนูู ุทูุจ

## ุฃููุงุน ุงูุฃุฎุทุงุก ุงููุฏุนููุฉ

- `api_error` - ุฎุทุฃ ูู API
- `db_error` - ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- `email_error` - ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุฅูููู
- `notification_error` - ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ
- `auth_error` - ุฎุทุฃ ูู ุงููุตุงุฏูุฉ

## ุงูุฃูุงู

- ุฌููุน API endpoints ูุญููุฉ ุจุงููุตุงุฏูุฉ
- Cron jobs ูุญููุฉ ุจู `CRON_SECRET`
- ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูุดูุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงูุณุฌูุงุช ุชุญุชูุธ ุจูุนูููุงุช ุงููุณุชุฎุฏููู ุงููุญุฏูุฏุฉ ููุท

## ุงูุชุทููุฑ ุงููุณุชูุจูู

- [ ] ุฅุถุงูุฉ ุชูุจููุงุช ููุฑูุฉ ุนุจุฑ ุงูุฅูููู/SMS
- [ ] ุชูุงุฑูุฑ PDF ููุฅุญุตุงุฆูุงุช
- [ ] ุชุญูููุงุช ูุชูุฏูุฉ ูุน ุฑุณูู ุจูุงููุฉ
- [ ] ูุฑุงูุจุฉ ุงูุฃุฏุงุก ูู ุงูููุช ุงููุนูู
- [ ] ุชูุงูู ูุน ุฎุฏูุงุช ูุฑุงูุจุฉ ุฎุงุฑุฌูุฉ (DataDog, New Relic)